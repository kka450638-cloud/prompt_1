<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PROMPT//MASTER v2.0</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #020408;
  --surface: #080f1a;
  --surface2: #0d1829;
  --border: #0f2a4a;
  --neon: #00f5ff;
  --neon2: #ff00aa;
  --neon3: #00ff88;
  --neon4: #ffaa00;
  --text: #cce8ff;
  --text-dim: #4a7a9b;
  --text-muted: #1a3a5c;
  --glow: rgba(0,245,255,0.2);
  --glow2: rgba(255,0,170,0.2);
  --nav-bg: rgba(2,4,8,0.92);
  --code-bg: #020810;
  --code-text: #7dc8e8;
  --input-bg: #020810;
}

/* LIGHT MODE */
body.light {
  --bg: #f5f7fa;
  --surface: #ffffff;
  --surface2: #eef2f8;
  --border: #d0daea;
  --neon: #0066cc;
  --neon2: #cc0077;
  --neon3: #007744;
  --neon4: #996600;
  --text: #1a2640;
  --text-dim: #5a7090;
  --text-muted: #b0c0d4;
  --glow: rgba(0,102,204,0.15);
  --glow2: rgba(204,0,119,0.12);
  --nav-bg: rgba(245,247,250,0.95);
  --code-bg: #f0f4fa;
  --code-text: #2a5080;
  --input-bg: #f8fafc;
}
body.light::before { display: none; }
body.light::after {
  background-image:
    linear-gradient(rgba(0,102,204,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,102,204,0.04) 1px, transparent 1px);
}
body.light #particles { opacity: 0.15; }
body.light .logo {
  text-shadow: none;
  animation: none;
}
body.light .sh h2 { text-shadow: none; }
body.light .panel::before { background: linear-gradient(90deg,transparent,var(--neon),transparent); opacity:0.3; }
body.light .cb { background: var(--code-bg); color: var(--code-text); border-color: rgba(0,102,204,0.15); }
body.light .output-area { background: var(--input-bg); }
body.light .qa-textarea, body.light .battle-textarea,
body.light .form-g select, body.light .form-g input, body.light .form-g textarea,
body.light .builder-output { background: var(--input-bg); color: var(--text); border-color: var(--border); }
body.light .stat-box { box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
body.light .card { box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
body.light .card:hover { box-shadow: 0 4px 20px rgba(0,102,204,0.12); }
body.light .quiz-opt { background: var(--surface2); }
body.light .quiz-opt:hover:not(:disabled) { background: rgba(0,102,204,0.07); }
body.light ::-webkit-scrollbar-track { background: var(--surface2); }
body.light .ring-bg { stroke: var(--border); }
body.light .dropped-block { background: var(--surface); border-color: rgba(0,102,204,0.2); }
body.light .dropped-block textarea { color: var(--text); }

/* THEME TOGGLE */
.theme-toggle {
  flex-shrink: 0;
  background: none;
  border: 1px solid var(--border);
  border-radius: 20px;
  width: 52px;
  height: 26px;
  position: relative;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  padding: 3px;
}
.theme-toggle .tog-knob {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--neon);
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  transform: translateX(0);
  box-shadow: 0 0 8px var(--glow);
}
body.light .theme-toggle .tog-knob {
  transform: translateX(26px);
  background: var(--neon4);
  box-shadow: 0 2px 8px rgba(153,102,0,0.3);
}
body.light .theme-toggle { border-color: var(--border); }

*{margin:0;padding:0;box-sizing:border-box}

/* SCANLINE EFFECT */
body{
  font-family:'Noto Sans KR',sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
  cursor:crosshair;
}
body::before{
  content:'';position:fixed;inset:0;
  background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,245,255,0.015) 2px,rgba(0,245,255,0.015) 4px);
  pointer-events:none;z-index:9999;
}
/* grid */
body::after{
  content:'';position:fixed;inset:0;
  background-image:linear-gradient(rgba(0,245,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,245,255,0.03) 1px,transparent 1px);
  background-size:60px 60px;pointer-events:none;z-index:0;
}

/* CANVAS PARTICLES */
#particles{position:fixed;inset:0;z-index:1;pointer-events:none;}

/* NAV */
nav{
  position:sticky;top:0;z-index:500;
  background:var(--nav-bg);backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(0,245,255,0.15);
  padding:0 16px;height:56px;
  display:flex;align-items:center;gap:8px;
}
.logo{
  font-family:'Orbitron',monospace;font-size:16px;font-weight:900;
  color:var(--neon);letter-spacing:2px;flex-shrink:0;
  text-shadow:0 0 20px var(--neon),0 0 40px rgba(0,245,255,0.5);
  animation:glitch 4s infinite;
}
@keyframes glitch{
  0%,92%,100%{text-shadow:0 0 20px var(--neon),0 0 40px rgba(0,245,255,0.5);}
  93%{text-shadow:-2px 0 var(--neon2),2px 0 var(--neon),0 0 40px rgba(0,245,255,0.5);}
  95%{text-shadow:2px 0 var(--neon2),-2px 0 var(--neon),0 0 40px rgba(0,245,255,0.5);}
}
.logo span{color:var(--neon2);text-shadow:0 0 20px var(--neon2);}

.nav-links{display:flex;gap:2px;overflow-x:auto;scrollbar-width:none;flex:1;padding-left:8px;}
.nav-links::-webkit-scrollbar{display:none;}
.nav-btn{
  background:none;border:1px solid transparent;
  color:var(--text-dim);font-family:'JetBrains Mono',monospace;font-size:11px;
  padding:5px 12px;border-radius:3px;cursor:crosshair;white-space:nowrap;
  transition:all 0.2s;text-transform:uppercase;letter-spacing:1px;
}
.nav-btn:hover,.nav-btn.active{
  color:var(--neon);border-color:rgba(0,245,255,0.4);
  background:rgba(0,245,255,0.05);text-shadow:0 0 8px var(--neon);
}

/* CONTAINER */
.container{position:relative;z-index:2;max-width:1240px;margin:0 auto;padding:28px 16px 100px;}

/* SECTIONS */
.section{display:none;animation:fadeUp 0.35s ease;}
.section.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}

/* HERO */
.hero{text-align:center;padding:48px 20px 32px;position:relative;}
.hero h1{
  font-family:'Orbitron',monospace;font-size:clamp(24px,5vw,54px);
  font-weight:900;line-height:1;letter-spacing:4px;
  color:var(--neon);text-shadow:0 0 30px var(--neon),0 0 60px rgba(0,245,255,0.4);
  margin-bottom:8px;
}
.hero h1 span{color:var(--neon2);text-shadow:0 0 30px var(--neon2);}
.hero .ver{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-dim);letter-spacing:4px;margin-bottom:20px;}
.hero p{color:var(--text-dim);font-size:14px;max-width:480px;margin:0 auto 28px;line-height:1.8;}

.hero-stat-row{display:flex;justify-content:center;gap:24px;flex-wrap:wrap;margin-bottom:28px;}
.stat-box{
  background:var(--surface);border:1px solid rgba(0,245,255,0.15);border-radius:4px;
  padding:10px 20px;text-align:center;min-width:80px;
}
.stat-n{font-family:'Orbitron',monospace;font-size:22px;font-weight:700;color:var(--neon);}
.stat-l{font-size:10px;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase;margin-top:2px;}

.quick-btns{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;}
.qbtn{
  background:transparent;border:1px solid rgba(0,245,255,0.3);
  color:var(--neon);font-family:'JetBrains Mono',monospace;font-size:12px;
  padding:8px 18px;border-radius:3px;cursor:crosshair;
  transition:all 0.25s;text-transform:uppercase;letter-spacing:1px;
}
.qbtn:hover{background:rgba(0,245,255,0.1);box-shadow:0 0 16px var(--glow);transform:translateY(-2px);}
.qbtn.pink{border-color:rgba(255,0,170,0.4);color:var(--neon2);}
.qbtn.pink:hover{background:rgba(255,0,170,0.1);box-shadow:0 0 16px var(--glow2);}
.qbtn.green{border-color:rgba(0,255,136,0.4);color:var(--neon3);}
.qbtn.green:hover{background:rgba(0,255,136,0.1);box-shadow:0 0 16px rgba(0,255,136,0.2);}

/* PANEL */
.panel{
  background:var(--surface);border:1px solid var(--border);border-radius:4px;
  padding:20px;margin-bottom:16px;position:relative;overflow:hidden;
}
.panel::before{
  content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--neon),transparent);
  opacity:0.5;
}
.panel-title{
  font-family:'Orbitron',monospace;font-size:13px;font-weight:700;
  color:var(--neon);letter-spacing:2px;margin-bottom:14px;
  display:flex;align-items:center;gap:8px;
}
.panel-title::before{content:'>';color:var(--neon2);font-size:16px;}

/* CARD GRID */
.cg{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px;margin-top:16px;}
.card{
  background:var(--surface2);border:1px solid var(--border);border-radius:4px;
  padding:16px;transition:all 0.25s;cursor:crosshair;
}
.card:hover{border-color:rgba(0,245,255,0.5);box-shadow:0 0 24px var(--glow);transform:translateY(-2px);}
.card-title{font-size:14px;font-weight:700;color:var(--text);margin-bottom:8px;}
.card-sub{font-size:11px;color:var(--text-dim);margin-bottom:10px;letter-spacing:0.5px;}
.card-body{font-size:12px;color:var(--text-dim);line-height:1.7;}

/* CODE */
.cb{
  background:#020810;border:1px solid rgba(0,245,255,0.12);border-radius:3px;
  padding:12px 14px;font-family:'JetBrains Mono',monospace;font-size:11px;
  color:#7dc8e8;line-height:1.8;margin-top:10px;overflow-x:auto;
  white-space:pre-wrap;word-break:break-word;position:relative;
}
.cb .kw{color:var(--neon);}
.cb .str{color:var(--neon3);}
.cb .cmt{color:var(--text-muted);}
.cb .hl{color:var(--neon2);}
.cb .warn{color:var(--neon4);}

/* TAG */
.tag{
  display:inline-block;font-size:10px;font-family:'JetBrains Mono',monospace;
  padding:2px 8px;border-radius:2px;background:rgba(0,245,255,0.08);
  color:var(--neon);border:1px solid rgba(0,245,255,0.2);margin:2px;
}
.tag.p{background:rgba(255,0,170,0.08);color:var(--neon2);border-color:rgba(255,0,170,0.2);}
.tag.g{background:rgba(0,255,136,0.08);color:var(--neon3);border-color:rgba(0,255,136,0.2);}
.tag.y{background:rgba(255,170,0,0.08);color:var(--neon4);border-color:rgba(255,170,0,0.2);}

/* DIVIDER */
.div{height:1px;background:var(--border);margin:24px 0;position:relative;}
.div::after{content:'//';position:absolute;left:50%;top:-8px;transform:translateX(-50%);font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text-muted);background:var(--bg);padding:0 8px;}

/* SECTION HEADING */
.sh{margin-bottom:6px;}
.sh h2{font-family:'Orbitron',monospace;font-size:18px;color:var(--neon);letter-spacing:2px;text-shadow:0 0 20px var(--glow);}
.sh p{font-size:13px;color:var(--text-dim);margin-top:4px;line-height:1.7;}

/* EXPAND */
.fe{background:var(--surface2);border:1px solid var(--border);border-radius:4px;margin-bottom:10px;overflow:hidden;}
.fe-h{
  padding:12px 16px;display:flex;align-items:center;justify-content:space-between;
  cursor:crosshair;transition:background 0.2s;gap:12px;
}
.fe-h:hover{background:rgba(0,245,255,0.04);}
.fe-ht{font-size:13px;font-weight:700;color:var(--text);}
.fe-arr{color:var(--text-muted);font-size:10px;transition:transform 0.2s;font-family:'JetBrains Mono',monospace;}
.fe-b{padding:0 16px;max-height:0;overflow:hidden;transition:max-height 0.4s ease,padding 0.3s;}
.fe-b.open{max-height:1000px;padding:0 16px 16px;}
.fe-h.open .fe-arr{transform:rotate(180deg);color:var(--neon);}

/* ======= QUIZ GAME ======= */
.quiz-screen{min-height:400px;}
.quiz-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px;}
.quiz-score{font-family:'Orbitron',monospace;font-size:14px;color:var(--neon);text-shadow:0 0 10px var(--glow);}
.quiz-life{font-size:18px;letter-spacing:2px;}
.progress-bar{height:3px;background:var(--border);border-radius:2px;margin-bottom:24px;overflow:hidden;}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--neon),var(--neon2));transition:width 0.5s ease;border-radius:2px;box-shadow:0 0 8px var(--neon);}
.quiz-q{
  font-size:16px;font-weight:700;line-height:1.6;margin-bottom:20px;
  color:var(--text);padding:16px;background:var(--surface2);
  border:1px solid rgba(0,245,255,0.15);border-radius:4px;
  border-left:3px solid var(--neon);
}
.quiz-hint{font-size:11px;color:var(--text-dim);font-family:'JetBrains Mono',monospace;margin-top:8px;}
.quiz-opts{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;}
@media(max-width:560px){.quiz-opts{grid-template-columns:1fr;}}
.quiz-opt{
  background:var(--surface2);border:1px solid var(--border);
  color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:13px;
  padding:12px 16px;border-radius:3px;cursor:crosshair;
  text-align:left;transition:all 0.2s;line-height:1.5;
}
.quiz-opt:hover:not(:disabled){border-color:rgba(0,245,255,0.5);background:rgba(0,245,255,0.06);color:var(--neon);}
.quiz-opt.correct{border-color:var(--neon3);background:rgba(0,255,136,0.12);color:var(--neon3);animation:correctPulse 0.5s ease;}
.quiz-opt.wrong{border-color:var(--neon2);background:rgba(255,0,170,0.08);color:var(--neon2);}
@keyframes correctPulse{0%{transform:scale(1);}50%{transform:scale(1.02);}100%{transform:scale(1);}}
.quiz-feedback{
  padding:12px 16px;border-radius:3px;font-size:13px;line-height:1.7;
  margin-bottom:16px;display:none;
}
.quiz-feedback.show{display:block;}
.quiz-feedback.ok{background:rgba(0,255,136,0.08);border:1px solid rgba(0,255,136,0.3);color:var(--neon3);}
.quiz-feedback.fail{background:rgba(255,0,170,0.08);border:1px solid rgba(255,0,170,0.3);color:var(--neon2);}
.quiz-next-btn{
  background:transparent;border:1px solid var(--neon);color:var(--neon);
  font-family:'JetBrains Mono',monospace;font-size:12px;
  padding:10px 24px;border-radius:3px;cursor:crosshair;
  transition:all 0.2s;letter-spacing:1px;display:none;
}
.quiz-next-btn.show{display:inline-block;}
.quiz-next-btn:hover{background:rgba(0,245,255,0.1);box-shadow:0 0 16px var(--glow);}
.quiz-result{text-align:center;padding:40px 20px;}
.quiz-result h2{font-family:'Orbitron',monospace;font-size:28px;color:var(--neon);text-shadow:0 0 20px var(--glow);margin-bottom:16px;}
.quiz-result .final-score{font-family:'Orbitron',monospace;font-size:48px;font-weight:900;margin:20px 0;}
.rank-badge{display:inline-block;padding:8px 24px;border-radius:3px;font-family:'JetBrains Mono',monospace;font-size:14px;letter-spacing:2px;margin-bottom:24px;}

/* ======= QUALITY ANALYZER ======= */
.qa-layout{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
@media(max-width:700px){.qa-layout{grid-template-columns:1fr;}}
.qa-textarea{
  width:100%;background:#020810;border:1px solid var(--border);
  color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:13px;
  padding:14px;border-radius:3px;outline:none;resize:vertical;min-height:200px;
  line-height:1.8;transition:border-color 0.2s;
}
.qa-textarea:focus{border-color:rgba(0,245,255,0.4);}
.score-ring{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  margin:16px auto;position:relative;width:120px;height:120px;
}
.ring-svg{transform:rotate(-90deg);}
.ring-bg{fill:none;stroke:var(--border);stroke-width:8;}
.ring-fill{fill:none;stroke-width:8;stroke-linecap:round;transition:stroke-dashoffset 1s ease,stroke 0.5s;}
.ring-text{position:absolute;text-align:center;}
.ring-num{font-family:'Orbitron',monospace;font-size:24px;font-weight:900;}
.ring-label{font-size:10px;color:var(--text-dim);letter-spacing:1px;}
.criteria-list{margin-top:12px;}
.crit-row{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.crit-name{font-size:12px;color:var(--text-dim);width:80px;flex-shrink:0;}
.crit-bar{flex:1;height:6px;background:var(--border);border-radius:3px;overflow:hidden;}
.crit-fill{height:100%;border-radius:3px;transition:width 1s ease;}
.crit-val{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);width:28px;text-align:right;flex-shrink:0;}
.suggestion-list{margin-top:12px;}
.sug-item{
  padding:8px 12px;border-radius:3px;font-size:12px;margin-bottom:6px;
  border-left:2px solid;line-height:1.6;
}
.sug-high{border-color:var(--neon2);background:rgba(255,0,170,0.05);color:var(--text);}
.sug-mid{border-color:var(--neon4);background:rgba(255,170,0,0.05);color:var(--text);}
.sug-low{border-color:var(--neon3);background:rgba(0,255,136,0.05);color:var(--text);}

/* ======= BUILDER ======= */
.builder-layout{display:grid;grid-template-columns:240px 1fr;gap:16px;min-height:500px;}
@media(max-width:700px){.builder-layout{grid-template-columns:1fr;}}
.builder-blocks{
  background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:12px;
}
.builder-blocks h3{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-dim);letter-spacing:2px;margin-bottom:10px;text-transform:uppercase;}
.block-item{
  background:var(--surface);border:1px solid var(--border);border-radius:3px;
  padding:8px 12px;margin-bottom:6px;cursor:grab;font-size:12px;
  color:var(--text);transition:all 0.2s;user-select:none;
  display:flex;align-items:center;gap:8px;
}
.block-item:hover{border-color:rgba(0,245,255,0.4);color:var(--neon);}
.block-item:active{cursor:grabbing;}
.block-icon{font-size:14px;flex-shrink:0;}
.builder-canvas{
  background:var(--surface2);border:1px solid var(--border);border-radius:4px;
  padding:16px;position:relative;min-height:400px;
}
.canvas-empty{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:200px;color:var(--text-muted);font-size:12px;font-family:'JetBrains Mono',monospace;
  border:1px dashed var(--border);border-radius:3px;margin-bottom:12px;
  text-align:center;gap:8px;
}
.dropped-block{
  background:var(--surface);border:1px solid rgba(0,245,255,0.2);border-radius:3px;
  padding:10px 14px;margin-bottom:8px;display:flex;align-items:flex-start;gap:10px;
  position:relative;animation:dropIn 0.25s ease;
}
@keyframes dropIn{from{opacity:0;transform:translateY(-6px);}to{opacity:1;transform:translateY(0);}}
.dropped-block textarea{
  flex:1;background:transparent;border:none;color:var(--text);
  font-family:'Noto Sans KR',sans-serif;font-size:12px;outline:none;
  resize:none;line-height:1.7;min-height:48px;
}
.dropped-block .block-label{font-size:10px;color:var(--neon);font-family:'JetBrains Mono',monospace;flex-shrink:0;width:60px;letter-spacing:1px;padding-top:2px;}
.del-block{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:14px;padding:0 4px;flex-shrink:0;transition:color 0.2s;}
.del-block:hover{color:var(--neon2);}
.builder-output{
  background:#020810;border:1px solid var(--border);border-radius:3px;
  padding:14px;font-family:'JetBrains Mono',monospace;font-size:11px;
  color:#7dc8e8;line-height:1.8;min-height:100px;white-space:pre-wrap;
  margin-top:12px;word-break:break-word;
}
.builder-btns{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
.bb{
  background:transparent;border:1px solid;
  font-family:'JetBrains Mono',monospace;font-size:11px;
  padding:7px 16px;border-radius:3px;cursor:crosshair;
  transition:all 0.2s;letter-spacing:1px;text-transform:uppercase;
}
.bb.c{border-color:var(--neon);color:var(--neon);}
.bb.c:hover{background:rgba(0,245,255,0.1);}
.bb.p{border-color:var(--neon2);color:var(--neon2);}
.bb.p:hover{background:rgba(255,0,170,0.1);}
.bb.g{border-color:var(--neon3);color:var(--neon3);}
.bb.g:hover{background:rgba(0,255,136,0.1);}

/* ======= BATTLE ======= */
.battle-layout{display:grid;grid-template-columns:1fr auto 1fr;gap:12px;align-items:start;}
@media(max-width:700px){.battle-layout{grid-template-columns:1fr;}}
.battle-vs{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:8px;padding:20px 0;
}
.vs-text{
  font-family:'Orbitron',monospace;font-size:20px;font-weight:900;
  color:var(--neon2);text-shadow:0 0 20px var(--neon2);
  animation:vsPulse 2s infinite;
}
@keyframes vsPulse{0%,100%{opacity:1;}50%{opacity:0.6;}}
.battle-panel{background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:14px;}
.battle-label{font-family:'JetBrains Mono',monospace;font-size:10px;letter-spacing:2px;margin-bottom:8px;text-transform:uppercase;}
.battle-label.a{color:var(--neon);}
.battle-label.b{color:var(--neon2);}
.battle-textarea{
  width:100%;background:#020810;border:1px solid var(--border);
  color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:12px;
  padding:10px;border-radius:3px;outline:none;resize:vertical;min-height:120px;
  line-height:1.7;transition:border-color 0.2s;
}
.battle-textarea:focus{border-color:rgba(0,245,255,0.3);}
.battle-btn{
  width:100%;background:transparent;
  border:1px solid var(--neon2);color:var(--neon2);
  font-family:'JetBrains Mono',monospace;font-size:12px;
  padding:10px;border-radius:3px;cursor:crosshair;
  transition:all 0.2s;letter-spacing:1px;text-transform:uppercase;margin-top:10px;
}
.battle-btn:hover{background:rgba(255,0,170,0.1);box-shadow:0 0 20px var(--glow2);}
.battle-btn:disabled{opacity:0.4;cursor:not-allowed;}
.battle-result{
  margin-top:16px;display:grid;grid-template-columns:1fr 1fr;gap:12px;
}
.battle-res-card{
  background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:14px;
  font-size:12px;line-height:1.7;color:var(--text-dim);position:relative;
  transition:all 0.5s;
}
.battle-res-card.winner{
  border-color:var(--neon4);
  box-shadow:0 0 20px rgba(255,170,0,0.2);
}
.winner-badge{
  position:absolute;top:-10px;left:50%;transform:translateX(-50%);
  background:var(--neon4);color:#000;font-family:'JetBrains Mono',monospace;
  font-size:10px;padding:2px 10px;border-radius:10px;letter-spacing:1px;font-weight:700;
}
.battle-meter{height:6px;border-radius:3px;background:var(--border);margin:6px 0;overflow:hidden;}
.meter-fill{height:100%;border-radius:3px;transition:width 1.2s ease;}

/* ======= GENERATOR ======= */
.gen-layout{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
@media(max-width:700px){.gen-layout{grid-template-columns:1fr;}}
.form-g{margin-bottom:12px;}
.form-g label{display:block;font-size:11px;color:var(--text-dim);margin-bottom:5px;font-family:'JetBrains Mono',monospace;letter-spacing:1px;text-transform:uppercase;}
.form-g select,.form-g input,.form-g textarea{
  width:100%;background:#020810;border:1px solid var(--border);
  color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:13px;
  padding:9px 12px;border-radius:3px;outline:none;transition:border-color 0.2s;resize:vertical;
}
.form-g select:focus,.form-g input:focus,.form-g textarea:focus{border-color:rgba(0,245,255,0.4);}
.form-g select option{background:var(--surface);}
.chip-row{display:flex;flex-wrap:wrap;gap:5px;margin-top:5px;}
.chip{
  background:var(--surface2);border:1px solid var(--border);
  color:var(--text-dim);font-size:11px;padding:4px 10px;border-radius:2px;
  cursor:crosshair;transition:all 0.15s;white-space:nowrap;font-family:'JetBrains Mono',monospace;
}
.chip:hover{border-color:rgba(0,245,255,0.4);color:var(--neon);}
.chip.selected{border-color:var(--neon);color:var(--neon);background:rgba(0,245,255,0.08);}
.gen-btn{
  width:100%;background:transparent;border:1px solid var(--neon);color:var(--neon);
  font-family:'Orbitron',monospace;font-size:13px;font-weight:700;
  padding:12px;border-radius:3px;cursor:crosshair;transition:all 0.25s;
  letter-spacing:2px;text-transform:uppercase;margin-top:4px;
}
.gen-btn:hover{background:rgba(0,245,255,0.08);box-shadow:0 0 24px var(--glow);}
.gen-btn:disabled{opacity:0.3;cursor:not-allowed;box-shadow:none;}
.output-area{
  background:#020810;border:1px solid var(--border);border-radius:3px;
  padding:14px;font-size:13px;line-height:1.8;color:var(--text);
  white-space:pre-wrap;word-break:break-word;min-height:280px;
  font-family:'Noto Sans KR',sans-serif;
}
.output-ph{color:var(--text-muted);font-family:'JetBrains Mono',monospace;font-size:12px;text-align:center;padding-top:80px;line-height:2;}
.loading-line{
  display:none;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--neon);
  text-align:center;padding:30px;letter-spacing:2px;
}
.loading-line.v{display:block;}
.loading-line::after{content:'';animation:blink 0.7s infinite;display:inline-block;width:8px;height:12px;background:var(--neon);margin-left:4px;vertical-align:middle;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0;}}
.copy-btn{
  background:transparent;border:1px solid rgba(0,245,255,0.3);color:var(--text-dim);
  font-size:11px;padding:6px 14px;border-radius:3px;cursor:crosshair;
  font-family:'JetBrains Mono',monospace;transition:all 0.2s;float:right;margin-top:8px;
}
.copy-btn:hover{border-color:var(--neon3);color:var(--neon3);}

/* SCROLLBAR */
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:var(--bg);}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
::-webkit-scrollbar-thumb:hover{background:rgba(0,245,255,0.3);}

/* MOBILE NAV */
@media(max-width:480px){
  .nav-btn{font-size:9px;padding:4px 8px;}
  .cg{grid-template-columns:1fr;}
}

/* TYPEWRITER */
.typewriter{overflow:hidden;white-space:nowrap;border-right:2px solid var(--neon);animation:type 2s steps(30) forwards,blink-caret 0.7s step-end infinite;}
@keyframes type{from{width:0}to{width:100%}}
@keyframes blink-caret{from,to{border-color:transparent}50%{border-color:var(--neon)}}
</style>
</head>
<body>

<canvas id="particles"></canvas>

<nav>
  <div class="logo">PROMPT<span>//</span>MASTER</div>
  <div class="nav-links">
    <button class="nav-btn active" onclick="showSec('home')">í™ˆ</button>
    <button class="nav-btn" onclick="showSec('ref')">ë ˆí¼ëŸ°ìŠ¤</button>
    <button class="nav-btn" onclick="showSec('quiz')">ğŸ® í€´ì¦ˆ</button>
    <button class="nav-btn" onclick="showSec('analyzer')">ğŸ”¥ í’ˆì§ˆë¶„ì„</button>
    <button class="nav-btn" onclick="showSec('builder')">ğŸ§© ë¹Œë”</button>
    <button class="nav-btn" onclick="showSec('battle')">âš”ï¸ ë°°í‹€</button>
    <button class="nav-btn" onclick="showSec('gen')">ğŸ¤– ìƒì„±ê¸°</button>
  </div>
  <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ ì „í™˜">
    <div class="tog-knob" id="togKnob">ğŸŒ™</div>
  </button>
</nav>

<div class="container">

<div id="sec-home" class="section active">
  <div class="hero">
    <div class="ver">// SYSTEM ONLINE Â· v2.0 //</div>
    <h1>PROMPT<br><span>MASTER</span></h1>
    <p>í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ë§ˆìŠ¤í„° ì‹œìŠ¤í…œ â€” í€´ì¦ˆÂ·ë¶„ì„Â·ë¹Œë”Â·ë°°í‹€Â·AIìƒì„±ê¸°</p>
    <div class="hero-stat-row">
      <div class="stat-box"><div class="stat-n" style="color:var(--neon)">11</div><div class="stat-l">íŒ¨í„´</div></div>
      <div class="stat-box"><div class="stat-n" style="color:var(--neon2)">6</div><div class="stat-l">í”„ë ˆì„ì›Œí¬</div></div>
      <div class="stat-box"><div class="stat-n" style="color:var(--neon3)">20+</div><div class="stat-l">ì˜ˆì‹œ</div></div>
      <div class="stat-box"><div class="stat-n" style="color:var(--neon4)">5</div><div class="stat-l">ê¸°ëŠ¥</div></div>
    </div>
    <div class="quick-btns">
      <button class="qbtn" onclick="showSec('quiz')">ğŸ® í€´ì¦ˆ ì‹œì‘</button>
      <button class="qbtn pink" onclick="showSec('battle')">âš”ï¸ ë°°í‹€</button>
      <button class="qbtn green" onclick="showSec('builder')">ğŸ§© ë¹Œë”</button>
      <button class="qbtn" onclick="showSec('analyzer')" style="border-color:rgba(255,170,0,0.4);color:var(--neon4);">ğŸ”¥ ë¶„ì„ê¸°</button>
    </div>
  </div>

  <div class="cg">
    <div class="card" onclick="showSec('ref')">
      <div class="card-title">ğŸ“š ë ˆí¼ëŸ°ìŠ¤</div>
      <div class="card-sub">// íŒ¨í„´Â·í”„ë ˆì„ì›Œí¬Â·ì˜ˆì‹œ ì •ë¦¬</div>
      <div class="card-body">ìˆ˜ì—… ë‚´ìš©ì„ êµ¬ì¡°ì ìœ¼ë¡œ ì •ë¦¬í•œ ì¸í„°ë™í‹°ë¸Œ ë ˆí¼ëŸ°ìŠ¤</div>
    </div>
    <div class="card" onclick="showSec('quiz')">
      <div class="card-title">ğŸ® í€´ì¦ˆ ê²Œì„</div>
      <div class="card-sub">// ë°°ìš´ ë‚´ìš© í…ŒìŠ¤íŠ¸</div>
      <div class="card-body">í€´ì¦ˆë¡œ í”„ë¡¬í”„íŠ¸ íŒ¨í„´ ì§€ì‹ì„ ì ê²€í•˜ê³  ë­í¬ë¥¼ ì˜¬ë¦¬ì„¸ìš”</div>
    </div>
    <div class="card" onclick="showSec('analyzer')">
      <div class="card-title">ğŸ”¥ í’ˆì§ˆ ë¶„ì„ê¸°</div>
      <div class="card-sub">// ë‚´ í”„ë¡¬í”„íŠ¸ ì±„ì </div>
      <div class="card-body">5ê°œ ê¸°ì¤€ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ë¥¼ ìë™ ë¶„ì„í•˜ê³  ê°œì„  ë°©í–¥ ì œì‹œ</div>
    </div>
    <div class="card" onclick="showSec('builder')">
      <div class="card-title">ğŸ§© í”„ë¡¬í”„íŠ¸ ë¹Œë”</div>
      <div class="card-sub">// ë“œë˜ê·¸&ë“œë¡­ ì¡°ë¦½</div>
      <div class="card-body">ë¸”ë¡ì„ í´ë¦­í•´ ìŒ“ìœ¼ë©´ êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ê°€ ì™„ì„±ë©ë‹ˆë‹¤</div>
    </div>
    <div class="card" onclick="showSec('battle')">
      <div class="card-title">âš”ï¸ í”„ë¡¬í”„íŠ¸ ë°°í‹€</div>
      <div class="card-sub">// ë‘ í”„ë¡¬í”„íŠ¸ ëŒ€ê²°</div>
      <div class="card-body">ë‘ í”„ë¡¬í”„íŠ¸ë¥¼ AIê°€ ë¹„êµ ë¶„ì„í•´ ìŠ¹ìë¥¼ ê°€ë¦½ë‹ˆë‹¤</div>
    </div>
    <div class="card" onclick="showSec('gen')">
      <div class="card-title">ğŸ¤– AI ìƒì„±ê¸°</div>
      <div class="card-sub">// OpenAI ì—°ë™</div>
      <div class="card-body">íŒ¨í„´ê³¼ ëª©í‘œë¥¼ ì…ë ¥í•˜ë©´ AIê°€ ë§ì¶¤ í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤</div>
    </div>
  </div>
</div>

<div id="sec-ref" class="section">
  <div class="sh"><h2>// REFERENCE</h2><p>ìˆ˜ì—…ì—ì„œ ë°°ìš´ í”„ë¡¬í”„íŠ¸ íŒ¨í„´ê³¼ í”„ë ˆì„ì›Œí¬ ë ˆí¼ëŸ°ìŠ¤</p></div>
  
  <div class="panel">
    <div class="panel-title">í”„ë¡¬í”„íŠ¸ 3ê°€ì§€ ìœ í˜•</div>
    <div class="cg">
      <div class="card">
        <div class="card-title">ğŸ“– ì„œìˆ í˜•</div>
        <div class="tag">ë§¥ë½ ì¤‘ì‹¬</div><div class="tag g">ìœ ì—°ì„± ë†’ìŒ</div><div class="tag p">ì¬ì‚¬ìš© ë‚®ìŒ</div>
        <div class="cb"><span class="kw">ë‹¹ì‹ ì€</span> 10ë…„ ê²½ë ¥ì˜ ë¬´ì—­ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
<span class="cmt">â†’ ë§¥ë½ê³¼ ë°°ê²½ìœ¼ë¡œ ìƒí™© ì´í•´ ìœ ë„</span></div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“‹ ì§€ì¹¨í˜•</div>
        <div class="tag">ê·œì¹™ ì¤‘ì‹¬</div><div class="tag y">ìœ ì—°ì„± ì¤‘ê°„</div>
        <div class="cb"><span class="str">1.</span> í•¨ìˆ˜ëª…ì€ snake_case
<span class="str">2.</span> docstring í¬í•¨
<span class="str">3.</span> ì˜ˆì™¸ì²˜ë¦¬ í•„ìˆ˜
<span class="str">4.</span> json ë°˜í™˜</div>
      </div>
      <div class="card">
        <div class="card-title">âš™ï¸ í•¨ìˆ˜í˜• êµ¬ì¡°</div>
        <div class="tag">êµ¬ì¡° ì¤‘ì‹¬</div><div class="tag p">ìœ ì—°ì„± ë‚®ìŒ</div><div class="tag g">ì¬ì‚¬ìš© ë†’ìŒ</div>
        <div class="cb"><span class="kw">ì…ë ¥</span>: {product}, {hs_code}, {country}
<span class="kw">ì¶œë ¥</span>: {"ê´€ì„¸ìœ¨","ê·œì œì‚¬í•­","í•„ìš”ì„œë¥˜"}</div>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title">ìƒ· í”„ë¡¬í”„íŒ…</div>
    <div class="cg">
      <div class="card"><div class="card-title">0ï¸âƒ£ ì œë¡œìƒ·</div><div class="card-body">ì˜ˆì‹œ ì—†ì´ ë°”ë¡œ ì§€ì‹œ â†’ AIê°€ ìŠ¤ìŠ¤ë¡œ ì¶”ë¡ </div></div>
      <div class="card"><div class="card-title">1ï¸âƒ£ ì›ìƒ·</div><div class="card-body">ì˜ˆì‹œ 1ê°œ ì œê³µ â†’ íŒ¨í„´ íŒíŠ¸ ë¶€ì—¬</div></div>
      <div class="card"><div class="card-title">ğŸ”¢ í“¨ìƒ·</div><div class="card-body">ì˜ˆì‹œ 2ê°œ ì´ìƒ â†’ ì¼ê´€ëœ íŒ¨í„´ í•™ìŠµ</div></div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title">ì£¼ìš” íŒ¨í„´ & í”„ë ˆì„ì›Œí¬</div>
    <div class="fe"><div class="fe-h" onclick="tFE(this)"><div><span class="fe-ht">ğŸ­ í˜ë¥´ì†Œë‚˜ íŒ¨í„´</span> <span class="tag">ë‹¨ì¼</span><span class="tag">ë©€í‹°</span></div><div class="fe-arr">â–¼</div></div>
    <div class="fe-b">
      <div class="cb"><span class="kw">ë‹¹ì‹ ì€</span> 20ë…„ ê²½ë ¥ì˜ ê´€ì„¸ì‚¬ì…ë‹ˆë‹¤.
<span class="str">FTA í˜‘ì •ì„¸ìœ¨ ì „ë¬¸ê°€</span>ë¡œ ì‰½ê³  ì‹¤ìš©ì ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.</div>
    </div></div>

    <div class="fe"><div class="fe-h" onclick="tFE(this)"><div><span class="fe-ht">ğŸ”‘ ëŒ€ì•ˆ ì ‘ê·¼ë²• íŒ¨í„´</span> <span class="tag">4ê°€ì§€ ìœ í˜•</span></div><div class="fe-arr">â–¼</div></div>
    <div class="fe-b"><div class="cb">ëª¨ë“  ë°©ë²•ì„ ë‚˜ì—´í•˜ê³  <span class="hl">ê°ê°ì˜ ì¥ë‹¨ì </span>ì„ ë¹„êµí•´ì¤˜
â†’ ì„ íƒê¶Œì´ ì‚¬ëŒì—ê²Œ ëŒì•„ì˜´</div></div></div>

    <div class="fe"><div class="fe-h" onclick="tFE(this)"><div><span class="fe-ht">ğŸª ë¦¬í”Œë ‰ì…˜ íŒ¨í„´</span> <span class="tag">ì´ˆì•ˆâ†’ë¹„í‰â†’ê°œì„ </span></div><div class="fe-arr">â–¼</div></div>
    <div class="fe-b"><div class="cb"><span class="str">[ì´ˆì•ˆ]</span> â†’ <span class="hl">[ìê¸°ë¹„í‰]</span> â†’ <span class="kw">[ê°œì„ ë³¸]</span>
AIê°€ ìŠ¤ìŠ¤ë¡œ ì•½ì  ë¶„ì„ í›„ ê°œì„ </div></div></div>

    <div class="fe"><div class="fe-h" onclick="tFE(this)"><div><span class="fe-ht">â­ CO-STAR í”„ë ˆì„ì›Œí¬</span></div><div class="fe-arr">â–¼</div></div>
    <div class="fe-b"><div class="cb"><span class="kw">C</span>ontext / <span class="kw">O</span>bjective / <span class="kw">S</span>tyle
<span class="kw">T</span>one / <span class="kw">A</span>udience / <span class="kw">R</span>esponse</div></div></div>

    <div class="fe"><div class="fe-h" onclick="tFE(this)"><div><span class="fe-ht">ğŸŒ¹ ROSES í”„ë ˆì„ì›Œí¬</span></div><div class="fe-arr">â–¼</div></div>
    <div class="fe-b"><div class="cb"><span class="kw">R</span>ole / <span class="kw">O</span>bjective / <span class="kw">S</span>cenario
<span class="kw">E</span>xpected Solution / <span class="kw">S</span>teps</div></div></div>
  </div>
</div>

<div id="sec-quiz" class="section">
  <div class="sh"><h2>// QUIZ MODE</h2><p>ë°°ìš´ í”„ë¡¬í”„íŠ¸ íŒ¨í„´ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”. í‹€ë¦¬ë©´ ëª©ìˆ¨ì´ ì¤„ì–´ë“­ë‹ˆë‹¤!</p></div>
  <div class="panel">
    <div id="quiz-start">
      <div style="text-align:center;padding:40px 20px;">
        <div style="font-family:'Orbitron',monospace;font-size:32px;color:var(--neon);text-shadow:0 0 20px var(--glow);margin-bottom:16px;">ğŸ® QUIZ START</div>
        <p style="color:var(--text-dim);font-size:14px;margin-bottom:24px;line-height:1.8;">ì´ 10ë¬¸ì œ Â· 5ê°œ ëª©ìˆ¨ Â· í”„ë¡¬í”„íŠ¸ íŒ¨í„´ ë§ˆìŠ¤í„° ë„ì „!</p>
        <button class="qbtn" style="font-size:15px;padding:12px 32px;" onclick="startQuiz()">// START GAME</button>
      </div>
    </div>
    <div id="quiz-play" style="display:none;">
      <div class="quiz-header">
        <div class="quiz-score">SCORE: <span id="qScore">0</span></div>
        <div style="text-align:center;"><div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text-dim);">Q <span id="qNum">1</span>/10</div></div>
        <div class="quiz-life" id="qLife">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</div>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="qProgress" style="width:0%"></div></div>
      <div class="quiz-q" id="qQuestion"></div>
      <div class="quiz-hint" id="qHint"></div>
      <div class="quiz-opts" id="qOpts"></div>
      <div class="quiz-feedback" id="qFeedback"></div>
      <button class="quiz-next-btn" id="qNext" onclick="nextQ()">NEXT //</button>
    </div>
    <div id="quiz-result" style="display:none;" class="quiz-result">
      <h2>// GAME OVER</h2>
      <div class="final-score" id="finalScore" style="color:var(--neon);text-shadow:0 0 30px var(--glow);"></div>
      <div class="rank-badge" id="rankBadge"></div>
      <p id="rankMsg" style="color:var(--text-dim);margin-bottom:24px;font-size:14px;"></p>
      <button class="qbtn" onclick="startQuiz()">// PLAY AGAIN</button>
    </div>
  </div>
</div>

<div id="sec-analyzer" class="section">
  <div class="sh"><h2>// QUALITY ANALYZER</h2><p>ë‚´ í”„ë¡¬í”„íŠ¸ë¥¼ OpenAIê°€ ì‹¬ì¸µ ë¶„ì„í•©ë‹ˆë‹¤ â€” ì ìˆ˜Â·ì½”ë©˜íŠ¸Â·ê°œì„ ì•ˆÂ·íˆìŠ¤í† ë¦¬ ê¸°ë¡</p></div>

  <div class="qa-layout">
    <div class="panel" style="margin:0;">
      <div class="panel-title">í”„ë¡¬í”„íŠ¸ ì…ë ¥</div>
      <textarea class="qa-textarea" id="qaInput" rows="10" placeholder="ë¶„ì„í•  í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...

ì˜ˆì‹œ:
ë‹¹ì‹ ì€ ë¬´ì—­ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì•„ë˜ í’ˆëª©ì˜ HS Codeë¥¼ ë¶„ë¥˜í•˜ì„¸ìš”.
ê²°ê³¼ëŠ” JSONìœ¼ë¡œ ë°˜í™˜í•˜ì„¸ìš”."></textarea>

      <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;">
        <button class="bb c" style="flex:1;padding:10px;" onclick="analyzePrompt(false)">ğŸ”¥ ë¹ ë¥¸ ë¶„ì„ (ìì²´)</button>
        <button class="bb g" style="flex:1;padding:10px;" onclick="analyzePrompt(true)">ğŸ¤– AI ì‹¬ì¸µ ë¶„ì„</button>
      </div>

      <div style="margin-top:12px;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);margin-bottom:6px;letter-spacing:1px;">QUICK SAMPLES</div>
        <div class="chip-row">
          <div class="chip" onclick="loadSample('good')">âœ… ìš°ìˆ˜ ì˜ˆì‹œ</div>
          <div class="chip" onclick="loadSample('mid')">âš¡ ë³´í†µ ì˜ˆì‹œ</div>
          <div class="chip" onclick="loadSample('bad')">âŒ ë¶€ì‹¤ ì˜ˆì‹œ</div>
        </div>
      </div>

      <div style="margin-top:16px;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);margin-bottom:8px;letter-spacing:1px;display:flex;justify-content:space-between;align-items:center;">
          <span>// HISTORY</span>
          <button onclick="clearHistory()" style="background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:11px;font-family:'JetBrains Mono',monospace;">CLEAR</button>
        </div>
        <div id="historyList" style="max-height:180px;overflow-y:auto;"></div>
        <div id="historyEmpty" style="font-size:12px;color:var(--text-muted);font-family:'JetBrains Mono',monospace;text-align:center;padding:12px;">// ë¶„ì„ ê¸°ë¡ ì—†ìŒ</div>
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:12px;">
      <div class="panel" style="margin:0;">
        <div class="panel-title">ë¶„ì„ ê²°ê³¼</div>

        <div id="qa-loading" style="display:none;text-align:center;padding:24px;">
          <div class="loading-line v" style="display:block;">AI ANALYZING</div>
        </div>

        <div id="qa-empty" style="text-align:center;padding:32px;color:var(--text-muted);font-family:'JetBrains Mono',monospace;font-size:12px;line-height:2;">
          // í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ê³ <br>ë¶„ì„ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”
        </div>

        <div id="qa-result" style="display:none;">
          <div style="display:flex;align-items:center;gap:20px;flex-wrap:wrap;margin-bottom:16px;">
            <div class="score-ring">
              <svg class="ring-svg" width="120" height="120" viewBox="0 0 120 120">
                <circle class="ring-bg" cx="60" cy="60" r="50"/>
                <circle class="ring-fill" id="ringFill" cx="60" cy="60" r="50" stroke-dasharray="314" stroke-dashoffset="314"/>
              </svg>
              <div class="ring-text">
                <div class="ring-num" id="ringNum">0</div>
                <div class="ring-label">/ 100</div>
              </div>
            </div>
            <div style="flex:1;min-width:160px;">
              <div id="gradeLabel" style="font-family:'Orbitron',monospace;font-size:16px;font-weight:900;margin-bottom:10px;"></div>
              <div class="criteria-list" id="criteriaList"></div>
            </div>
          </div>

          <div id="aiCommentBox" style="display:none;margin-bottom:12px;padding:14px;border-radius:4px;border-left:3px solid var(--neon3);background:rgba(0,255,136,0.04);font-size:13px;line-height:1.8;color:var(--text);">
            <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--neon3);letter-spacing:2px;margin-bottom:6px;">ğŸ¤– AI COMMENT</div>
            <div id="aiCommentText"></div>
          </div>

          <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-dim);letter-spacing:2px;margin-bottom:8px;">SUGGESTIONS</div>
          <div class="suggestion-list" id="suggList"></div>
        </div>
      </div>

      <div class="panel" id="improvedPanel" style="margin:0;display:none;">
        <div class="panel-title">âœ¨ AI ê°œì„  ë²„ì „</div>
        <div id="improvedLoading" style="display:none;text-align:center;padding:16px;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--neon);">GENERATING IMPROVED VERSION...</div>
        <div id="improvedText" style="font-size:12px;line-height:1.8;color:var(--text);white-space:pre-wrap;word-break:break-word;background:var(--input-bg);border:1px solid var(--border);border-radius:3px;padding:14px;"></div>
        <div style="display:flex;gap:8px;margin-top:10px;">
          <button class="bb g" onclick="copyImproved()" style="flex:1;">COPY ê°œì„ ë³¸</button>
          <button class="bb c" onclick="loadImproved()" style="flex:1;">ë¹Œë”ë¡œ ë³´ë‚´ê¸°</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="sec-builder" class="section">
  <div class="sh"><h2>// PROMPT BUILDER</h2><p>ë¸”ë¡ì„ í´ë¦­í•´ì„œ ìŒ“ìœ¼ë©´ êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ê°€ ìë™ ì™„ì„±ë©ë‹ˆë‹¤.</p></div>
  <div class="builder-layout">
    <div class="builder-blocks">
      <h3>// BLOCKS</h3>
      <div class="block-item" data-key="role" data-label="#ì—­í• " onclick="addBlock(this)"><span class="block-icon">ğŸ­</span>ì—­í•  (Role)</div>
      <div class="block-item" data-key="task" data-label="#ì‘ì—…" onclick="addBlock(this)"><span class="block-icon">ğŸ“‹</span>ì‘ì—… (Task)</div>
      <div class="block-item" data-key="context" data-label="#ë§¥ë½" onclick="addBlock(this)"><span class="block-icon">ğŸŒ</span>ë§¥ë½ (Context)</div>
      <div class="block-item" data-key="input" data-label="#ì…ë ¥" onclick="addBlock(this)"><span class="block-icon">ğŸ“¥</span>ì…ë ¥ (Input)</div>
      <div class="block-item" data-key="constraint" data-label="#ì œì•½" onclick="addBlock(this)"><span class="block-icon">â›”</span>ì œì•½ (Constraint)</div>
      <div class="block-item" data-key="output" data-label="#ì¶œë ¥í˜•ì‹" onclick="addBlock(this)"><span class="block-icon">ğŸ“¤</span>ì¶œë ¥ í˜•ì‹</div>
      <div class="block-item" data-key="tone" data-label="#ë§íˆ¬" onclick="addBlock(this)"><span class="block-icon">ğŸ—£ï¸</span>ë§íˆ¬ (Tone)</div>
      <div class="block-item" data-key="example" data-label="#ì˜ˆì‹œ" onclick="addBlock(this)"><span class="block-icon">ğŸ’¡</span>ì˜ˆì‹œ (Example)</div>
      <div class="block-item" data-key="persona" data-label="#ì´ìš©ìì •ë³´" onclick="addBlock(this)"><span class="block-icon">ğŸ‘¤</span>ì´ìš©ì í˜ë¥´ì†Œë‚˜</div>
      <div class="block-item" data-key="priority" data-label="#ìš°ì„ ìˆœìœ„" onclick="addBlock(this)"><span class="block-icon">ğŸ”´</span>ìš°ì„ ìˆœìœ„</div>
      <hr style="border-color:var(--border);margin:10px 0;">
      <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);margin-bottom:6px;">TEMPLATES</div>
      <div class="block-item" onclick="loadTemplate('persona')" style="border-color:rgba(255,0,170,0.3);color:var(--neon2);"><span class="block-icon">âš¡</span>í˜ë¥´ì†Œë‚˜ í…œí”Œë¦¿</div>
      <div class="block-item" onclick="loadTemplate('costar')" style="border-color:rgba(0,255,136,0.3);color:var(--neon3);"><span class="block-icon">âš¡</span>CO-STAR í…œí”Œë¦¿</div>
    </div>
    <div class="builder-canvas">
      <div id="canvas-empty" class="canvas-empty">
        <span style="font-size:24px;">ğŸ§©</span>
        <span>ì™¼ìª½ ë¸”ë¡ì„ í´ë¦­í•´ì„œ ì¶”ê°€í•˜ì„¸ìš”</span>
      </div>
      <div id="canvas-blocks"></div>
      <div class="builder-btns">
        <button class="bb c" onclick="previewPrompt()">// PREVIEW</button>
        <button class="bb g" onclick="copyBuilderOutput()">COPY</button>
        <button class="bb p" onclick="clearCanvas()">CLEAR</button>
      </div>
      <div id="builderOutput" class="builder-output" style="display:none;"></div>
    </div>
  </div>
</div>

<div id="sec-battle" class="section">
  <div class="sh"><h2>// PROMPT BATTLE</h2><p>ë‘ í”„ë¡¬í”„íŠ¸ë¥¼ OpenAIê°€ ë¹„êµ ë¶„ì„í•´ ì–´ë–¤ ìª½ì´ ë” íš¨ê³¼ì ì¸ì§€ íŒì •í•©ë‹ˆë‹¤.</p></div>
  <div class="battle-layout">
    <div class="battle-panel">
      <div class="battle-label a">// CHALLENGER A</div>
      <textarea class="battle-textarea" id="battleA" placeholder="ì²« ë²ˆì§¸ í”„ë¡¬í”„íŠ¸ ì…ë ¥..."></textarea>
    </div>
    <div class="battle-vs">
      <div class="vs-text">VS</div>
      <button class="battle-btn" id="battleBtn" onclick="doBattle()">âš”ï¸ BATTLE</button>
    </div>
    <div class="battle-panel">
      <div class="battle-label b">// CHALLENGER B</div>
      <textarea class="battle-textarea" id="battleB" placeholder="ë‘ ë²ˆì§¸ í”„ë¡¬í”„íŠ¸ ì…ë ¥..."></textarea>
    </div>
  </div>

  <div id="battle-loading" style="display:none;text-align:center;padding:30px;">
    <div style="font-family:'Orbitron',monospace;color:var(--neon2);font-size:14px;letter-spacing:2px;animation:vsPulse 1s infinite;">âš”ï¸ ANALYZING BATTLE...</div>
  </div>

  <div id="battle-result-area" style="display:none;" class="panel" style="margin-top:16px;">
    <div class="panel-title">BATTLE RESULT</div>
    <div class="battle-result" id="battleResult"></div>
    <div id="battleAnalysis" style="margin-top:14px;font-size:13px;color:var(--text-dim);line-height:1.8;padding:12px;background:var(--surface2);border:1px solid var(--border);border-radius:3px;"></div>
  </div>
</div>

<div id="sec-gen" class="section">
  <div class="sh"><h2>// AI GENERATOR</h2><p>íŒ¨í„´Â·ëª©í‘œë¥¼ ì„ íƒí•˜ë©´ OpenAIê°€ ì‹¤ë¬´ìš© í”„ë¡¬í”„íŠ¸ë¥¼ ì¦‰ì‹œ ìƒì„±í•©ë‹ˆë‹¤.</p></div>
  <div class="gen-layout">
    <div class="panel" style="margin:0;">
      <div class="panel-title">ì„¤ì •</div>
      <div class="form-g">
        <label>íŒ¨í„´ ì„ íƒ</label>
        <select id="patSel">
          <option value="persona">ğŸ­ í˜ë¥´ì†Œë‚˜ íŒ¨í„´</option>
          <option value="multi">ğŸ§‘â€ğŸ¤â€ğŸ§‘ ë©€í‹° í˜ë¥´ì†Œë‚˜</option>
          <option value="recipe">ğŸŸ¡ ë ˆì‹œí”¼ íŒ¨í„´</option>
          <option value="alt">ğŸ”‘ ëŒ€ì•ˆ ì ‘ê·¼ë²•</option>
          <option value="costar">â­ CO-STAR</option>
          <option value="roses">ğŸŒ¹ ROSES</option>
          <option value="focus">ğŸ¯ FOCUS</option>
          <option value="5w1h">ğŸ“‹ 5W1H</option>
          <option value="cog">ğŸ“Š ì¸ì§€ ê²€ì¦ì</option>
          <option value="ref">ğŸª ë¦¬í”Œë ‰ì…˜</option>
          <option value="inv">ğŸ”„ ë’¤ì§‘íŒ ìƒí˜¸ì‘ìš©</option>
        </select>
      </div>
      <div class="form-g">
        <label>ë„ë©”ì¸</label>
        <div class="chip-row">
          <div class="chip selected" onclick="selChip(this,'dom')">ë¬´ì—­/ìˆ˜ì¶œ</div>
          <div class="chip" onclick="selChip(this,'dom')">ë§ˆì¼€íŒ…</div>
          <div class="chip" onclick="selChip(this,'dom')">IT/ê°œë°œ</div>
          <div class="chip" onclick="selChip(this,'dom')">ë²•ë¬´</div>
          <div class="chip" onclick="selChip(this,'dom')">êµìœ¡</div>
          <div class="chip" onclick="selChip(this,'dom')">ê¸ˆìœµ</div>
        </div>
      </div>
      <div class="form-g">
        <label>ëª©í‘œ/ì£¼ì œ <span style="color:var(--neon2)">*</span></label>
        <textarea id="genGoal" rows="3" placeholder="ì˜ˆ: ë™ë‚¨ì•„ ì‹ ê·œ ë°”ì´ì–´ ë°œêµ´ ì´ë©”ì¼ ì‘ì„±"></textarea>
      </div>
      <div class="form-g">
        <label>ì¶œë ¥ ì–¸ì–´</label>
        <select id="genLang"><option>í•œêµ­ì–´</option><option>ì˜ì–´</option><option>í•œêµ­ì–´+ì˜ì–´</option></select>
      </div>
      <div class="form-g">
        <label>ì¶”ê°€ ì¡°ê±´ (ì„ íƒ)</label>
        <textarea id="genExtra" rows="2" placeholder="ì˜ˆ: 500ì ì´ë‚´, ì´ˆë³´ì ëŒ€ìƒ..."></textarea>
      </div>
      <button class="gen-btn" id="genBtn" onclick="doGenerate()">âœ¨ GENERATE //</button>
    </div>
    <div class="panel" style="margin:0;">
      <div class="panel-title">ìƒì„±ëœ í”„ë¡¬í”„íŠ¸</div>
      <div class="loading-line" id="genLoading">GENERATING</div>
      <div class="output-area" id="genOutput"><div class="output-ph">// WAITING FOR INPUT<br>â† ì„¤ì • í›„ GENERATE í´ë¦­</div></div>
      <button class="copy-btn" id="genCopy" onclick="copyGen()" style="display:none;">ğŸ“‹ COPY</button>
    </div>
  </div>
</div>

</div><script>
// ==========================================
// í™˜ê²½ ë³€ìˆ˜ ì—°ë™ (.env íŒŒì¼ ì‚¬ìš© í™˜ê²½)
// ==========================================


// PARTICLES
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
let W,H,pts=[];
function resizeCanvas(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;}
resizeCanvas();window.addEventListener('resize',resizeCanvas);
for(let i=0;i<60;i++)pts.push({x:Math.random()*2000,y:Math.random()*1200,vx:(Math.random()-0.5)*0.3,vy:(Math.random()-0.5)*0.3,r:Math.random()*1.5+0.5});
function animParticles(){
  ctx.clearRect(0,0,W,H);
  pts.forEach(p=>{
    p.x+=p.vx;p.y+=p.vy;
    if(p.x<0)p.x=W;if(p.x>W)p.x=0;
    if(p.y<0)p.y=H;if(p.y>H)p.y=0;
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle='rgba(0,245,255,0.3)';ctx.fill();
  });
  requestAnimationFrame(animParticles);
}
animParticles();

// NAV
function showSec(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('sec-'+id).classList.add('active');
  const map={home:0,ref:1,quiz:2,analyzer:3,builder:4,battle:5,gen:6};
  document.querySelectorAll('.nav-btn')[map[id]]?.classList.add('active');
  window.scrollTo(0,0);
}

// THEME TOGGLE
function toggleTheme(){
  const isLight = document.body.classList.toggle('light');
  document.getElementById('togKnob').textContent = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
  localStorage.setItem('theme', isLight ? 'light' : 'dark');
}
// Restore theme
if(localStorage.getItem('theme')==='light'){
  document.body.classList.add('light');
  document.addEventListener('DOMContentLoaded',()=>{
    const k=document.getElementById('togKnob');
    if(k) k.textContent='â˜€ï¸';
  });
}

// EXPAND
function tFE(h){
  const b=h.nextElementSibling;
  const o=b.classList.contains('open');
  b.classList.toggle('open',!o);h.classList.toggle('open',!o);
}

// CHIP
function selChip(c,grp){
  c.closest('.chip-row').querySelectorAll('.chip').forEach(x=>x.classList.remove('selected'));
  c.classList.add('selected');
}

// ======= QUIZ DATA =======
const QS=[
  {q:"ë‹¤ìŒ ì¤‘ 'ì„œìˆ í˜• í”„ë¡¬í”„íŠ¸'ì˜ íŠ¹ì§•ìœ¼ë¡œ ì˜¬ë°”ë¥¸ ê²ƒì€?",hint:"ì¬ì‚¬ìš©ì„±ê³¼ ìœ ì—°ì„±ì„ ìƒê°í•´ë³´ì„¸ìš”",opts:["ì¬ì‚¬ìš©ì„±ì´ ë†’ê³  ìœ ì—°ì„±ì´ ë‚®ë‹¤","ë§¥ë½ ì¤‘ì‹¬ì´ë©° ìœ ì—°ì„±ì´ ë†’ë‹¤","ê·œì¹™ ì¤‘ì‹¬ì´ë©° êµ¬ì¡°í™”ëœ ì¶œë ¥ì„ ìœ ë„í•œë‹¤","ì…ì¶œë ¥ì„ ëª…í™•íˆ ì •ì˜í•œë‹¤"],ans:1,exp:"ì„œìˆ í˜•ì€ ë§¥ë½ê³¼ ë°°ê²½ì„ ì„¤ëª…í•˜ì—¬ AIê°€ ìƒí™©ì„ ì´í•´í•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤. ìœ ì—°ì„±ì´ ë†’ì§€ë§Œ ì¬ì‚¬ìš©ì„±ì€ ë‚®ì€ ê²ƒì´ íŠ¹ì§•ì…ë‹ˆë‹¤."},
  {q:"ì˜ˆì‹œë¥¼ ì „í˜€ ì œê³µí•˜ì§€ ì•Šê³  ë°”ë¡œ ì§€ì‹œí•˜ëŠ” í”„ë¡¬í”„íŒ… ë°©ì‹ì€?",hint:"0ê°œì˜ ì˜ˆì‹œ",opts:["ì›ìƒ·(One-shot)","í“¨ìƒ·(Few-shot)","ì œë¡œìƒ·(Zero-shot)","ë©€í‹°ìƒ·(Multi-shot)"],ans:2,exp:"ì œë¡œìƒ·(Zero-shot)ì€ ì˜ˆì‹œ ì—†ì´ ë°”ë¡œ ì§€ì‹œí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. AIê°€ í›ˆë ¨ëœ ì§€ì‹ë§Œìœ¼ë¡œ ì¶”ë¡ í•©ë‹ˆë‹¤."},
  {q:"CO-STAR í”„ë ˆì„ì›Œí¬ì—ì„œ 'T'ê°€ ëœ»í•˜ëŠ” ê²ƒì€?",hint:"ë§íˆ¬ë‚˜ ë¶„ìœ„ê¸°ì™€ ê´€ë ¨",opts:["Task(ì‘ì—…)","Time(ì‹œê°„)","Tone(ë§íˆ¬)","Target(ëŒ€ìƒ)"],ans:2,exp:"CO-STARì—ì„œ TëŠ” Tone(ë§íˆ¬/ë¶„ìœ„ê¸°)ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. Context/Objective/Style/Tone/Audience/Response"},
  {q:"í˜ë¥´ì†Œë‚˜ íŒ¨í„´ì˜ 'ì¢‹ì€ í˜ë¥´ì†Œë‚˜ 4ìš”ì†Œ'ì— í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ê²ƒì€?",hint:"í˜ë¥´ì†Œë‚˜ êµ¬ì„± í•µì‹¬ 4ê°€ì§€ë¥¼ ë– ì˜¬ë ¤ë³´ì„¸ìš”",opts:["ì—­í• ","ê²½ë ¥/ë°°ê²½","ì›”ê¸‰/ë³´ìˆ˜","ë§íˆ¬/íƒœë„"],ans:2,exp:"ì¢‹ì€ í˜ë¥´ì†Œë‚˜ 4ìš”ì†ŒëŠ” [ì—­í• ], [ê²½ë ¥/ë°°ê²½], [ì „ë¬¸ë¶„ì•¼], [ë§íˆ¬/íƒœë„]ì…ë‹ˆë‹¤. ì›”ê¸‰/ë³´ìˆ˜ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."},
  {q:"ë¦¬í”Œë ‰ì…˜ íŒ¨í„´ì˜ 3ë‹¨ê³„ ìˆœì„œë¡œ ì˜¬ë°”ë¥¸ ê²ƒì€?",hint:"AIê°€ ìê¸° ì„±ì°°í•˜ëŠ” ê³¼ì •",opts:["ë¹„í‰â†’ì´ˆì•ˆâ†’ê°œì„ ","ì´ˆì•ˆâ†’ë¹„í‰â†’ê°œì„ ","ê°œì„ â†’ì´ˆì•ˆâ†’ë¹„í‰","ì´ˆì•ˆâ†’ê°œì„ â†’ë¹„í‰"],ans:1,exp:"ë¦¬í”Œë ‰ì…˜ íŒ¨í„´: [ì´ˆì•ˆ] â†’ [ìê¸° ë¹„í‰] â†’ [ê°œì„ ë³¸] ìˆœì„œë¡œ ì§„í–‰ë©ë‹ˆë‹¤."},
  {q:"ë§ˆí¬ë‹¤ìš´ í”„ë¡¬í”„íŠ¸ì—ì„œ '>' ê¸°í˜¸ì˜ ì—­í• ì€?",hint:"ê°•ì¡°ì™€ ê´€ë ¨ëœ ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•",opts:["ì½”ë“œ ë¸”ëŸ­ ìƒì„±","í—¤ë”(ì œëª©) í‘œì‹œ","ì ˆëŒ€ ì§€ì¼œì•¼ í•  ì¡°ê±´ ê°•ì¡°","ëª©ë¡ ë‚˜ì—´"],ans:2,exp:"> ê¸°í˜¸(ì¸ìš©ë¬¸)ëŠ” ì ˆëŒ€ ì§€ì¼œì•¼ í•  ì¡°ê±´ì´ë‚˜ ì¤‘ìš”í•œ ë§¥ë½ì„ ë¶€ê°í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤."},
  {q:"'ë’¤ì§‘íŒ ìƒí˜¸ì‘ìš© íŒ¨í„´'ì˜ í•µì‹¬ íŠ¹ì§•ì€?",hint:"ëˆ„ê°€ ë¨¼ì € ì§ˆë¬¸ì„ í•˜ë‚˜ìš”?",opts:["ì‚¬ìš©ìê°€ ì˜ˆì‹œë¥¼ ë¨¼ì € ì œê³µ","AIê°€ ë¨¼ì € ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ê²°ê³¼ ìƒì„±","AIê°€ ì—¬ëŸ¬ ëŒ€ì•ˆì„ ë™ì‹œì— ì œì‹œ","ì‚¬ìš©ìê°€ ë‹¨ê³„ë³„ ì ˆì°¨ë¥¼ ì§€ì •"],ans:1,exp:"ë’¤ì§‘íŒ ìƒí˜¸ì‘ìš© íŒ¨í„´ì€ AIê°€ ë¨¼ì € í•„ìš”í•œ ì •ë³´ë¥¼ ì§ˆë¬¸í•˜ê³ , ëª¨ë“  ì •ë³´ê°€ ìˆ˜ì§‘ëœ í›„ ê²°ê³¼ë¥¼ ìƒì„±í•©ë‹ˆë‹¤."},
  {q:"ì¸ì§€ ê²€ì¦ì íŒ¨í„´ì˜ ëª©ì ì€?",hint:"ë³µì¡í•œ ì§ˆë¬¸ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í• ê¹Œìš”?",opts:["ì˜ˆì‹œë¥¼ ì—¬ëŸ¬ ê°œ ì œê³µí•˜ì—¬ íŒ¨í„´ í•™ìŠµ","ì§ˆë¬¸ì„ í•˜ìœ„ ì§ˆë¬¸ìœ¼ë¡œ ë¶„í•´í•˜ì—¬ ë‹¨ê³„ì ìœ¼ë¡œ ê²€ì¦","AIì—ê²Œ íŠ¹ì • ì—­í• ì„ ë¶€ì—¬","ì¶œë ¥ í˜•ì‹ì„ ì •í™•íˆ ì§€ì •"],ans:1,exp:"ì¸ì§€ ê²€ì¦ì íŒ¨í„´: ë³µì¡í•œ ì§ˆë¬¸ì„ í•˜ìœ„ ì§ˆë¬¸ìœ¼ë¡œ ë¶„í•´ â†’ ê°ê° ìˆœì„œëŒ€ë¡œ ê²€ì¦ â†’ í†µí•©ëœ íŒë‹¨ ë„ì¶œ"},
  {q:"ROSES í”„ë ˆì„ì›Œí¬ì—ì„œ 'E'ëŠ” ë¬´ì—‡ì„ ì˜ë¯¸í•˜ë‚˜ìš”?",hint:"ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ë¬¼",opts:["Example(ì˜ˆì‹œ)","Expected Solution(ê¸°ëŒ€ í•´ê²°ì±…)","Evaluation(í‰ê°€)","Experience(ê²½í—˜)"],ans:1,exp:"ROSESì—ì„œ EëŠ” Expected Solution(ê¸°ëŒ€ í•´ê²°ì±…)ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. Role/Objective/Scenario/Expected Solution/Steps"},
  {q:"ê°•ë„ í‘œí˜„ 4ë‹¨ê³„ ì¤‘ ê°€ì¥ ê°•í•œ í‘œí˜„ì€?",hint:"ìµœê°•ì˜ ê°•ì œì„±",opts:["ê°€ëŠ¥í•˜ë©´ ~í•˜ëŠ” í¸ì´ ì¢‹ìŠµë‹ˆë‹¤","ë°˜ë“œì‹œ, ê¼­, í•­ìƒ","ì ˆëŒ€ë¡œ, ì–´ë–¤ ê²½ìš°ì—ë„","~í•˜ì„¸ìš”, ~í•´ì£¼ì„¸ìš”"],ans:2,exp:"ê°•ë„ ë‹¨ê³„: 1ë‹¨ê³„(ê¶Œì¥)â†’2ë‹¨ê³„(ì¼ë°˜)â†’3ë‹¨ê³„(ê°•ì¡°)â†’4ë‹¨ê³„(ì ˆëŒ€). 'ì ˆëŒ€ë¡œ, ì–´ë–¤ ê²½ìš°ì—ë„'ê°€ 4ë‹¨ê³„(ìµœê°•)ì…ë‹ˆë‹¤."},
];

let qIdx=0,qScore=0,qLives=5,qAnswered=false;

function startQuiz(){
  qIdx=0;qScore=0;qLives=5;qAnswered=false;
  document.getElementById('quiz-start').style.display='none';
  document.getElementById('quiz-result').style.display='none';
  document.getElementById('quiz-play').style.display='block';
  renderQ();
}

function renderQ(){
  const q=QS[qIdx];
  document.getElementById('qNum').textContent=qIdx+1;
  document.getElementById('qScore').textContent=qScore;
  document.getElementById('qProgress').style.width=((qIdx/10)*100)+'%';
  document.getElementById('qLife').textContent='â¤ï¸'.repeat(qLives)+'ğŸ–¤'.repeat(5-qLives);
  document.getElementById('qQuestion').textContent=q.q;
  document.getElementById('qHint').textContent='ğŸ’¡ íŒíŠ¸: '+q.hint;
  const fb=document.getElementById('qFeedback');
  fb.classList.remove('show','ok','fail');fb.textContent='';
  document.getElementById('qNext').classList.remove('show');
  qAnswered=false;
  const opts=document.getElementById('qOpts');
  opts.innerHTML='';
  q.opts.forEach((o,i)=>{
    const btn=document.createElement('button');
    btn.className='quiz-opt';btn.textContent=o;
    btn.onclick=()=>answerQ(i,btn);
    opts.appendChild(btn);
  });
}

function answerQ(i,btn){
  if(qAnswered)return;qAnswered=true;
  const q=QS[qIdx];const correct=i===q.ans;
  const fb=document.getElementById('qFeedback');
  document.querySelectorAll('.quiz-opt').forEach((b,j)=>{
    b.disabled=true;
    if(j===q.ans)b.classList.add('correct');
    else if(j===i&&!correct)b.classList.add('wrong');
  });
  if(correct){
    qScore+=10;fb.className='quiz-feedback show ok';fb.textContent='âœ… ì •ë‹µ! '+q.exp;
  }else{
    qLives--;fb.className='quiz-feedback show fail';fb.textContent='âŒ ì˜¤ë‹µ! '+q.exp;
  }
  document.getElementById('qLife').textContent='â¤ï¸'.repeat(Math.max(0,qLives))+'ğŸ–¤'.repeat(5-Math.max(0,qLives));
  document.getElementById('qNext').classList.add('show');
  if(qLives<=0){document.getElementById('qNext').textContent='GAME OVER //';document.getElementById('qNext').onclick=showResult;}
}

function nextQ(){
  qIdx++;
  if(qIdx>=QS.length||qLives<=0)showResult();
  else renderQ();
}

function showResult(){
  document.getElementById('quiz-play').style.display='none';
  document.getElementById('quiz-result').style.display='block';
  document.getElementById('finalScore').textContent=qScore+'ì ';
  const pct=qScore/100;
  let rank,msg,c;
  if(pct>=0.9){rank='S // í”„ë¡¬í”„íŠ¸ ë§ˆìŠ¤í„°';msg='ì™„ë²½í•©ë‹ˆë‹¤! ë‹¹ì‹ ì€ ì§„ì •í•œ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´!';c='var(--neon)';}
  else if(pct>=0.7){rank='A // í”„ë¡¬í”„íŠ¸ ì „ë¬¸ê°€';msg='í›Œë¥­í•©ë‹ˆë‹¤! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•˜ë©´ ë§ˆìŠ¤í„°!';c='var(--neon3)';}
  else if(pct>=0.5){rank='B // í”„ë¡¬í”„íŠ¸ í•™ìŠµì';msg='ì¢‹ì•„ìš”! í‹€ë¦° ë¬¸ì œë¥¼ ë‹¤ì‹œ ë³µìŠµí•´ë³´ì„¸ìš”.';c='var(--neon4)';}
  else{rank='C // ë” ì—´ì‹¬íˆ!';msg='ë ˆí¼ëŸ°ìŠ¤ë¥¼ ë‹¤ì‹œ ë³´ê³  ë„ì „í•´ë³´ì„¸ìš”!';c='var(--neon2)';}
  const rb=document.getElementById('rankBadge');
  rb.textContent=rank;rb.style.background=c;rb.style.color='#000';
  document.getElementById('rankMsg').textContent=msg;
  document.getElementById('finalScore').style.color=c;
  document.getElementById('finalScore').style.textShadow='0 0 30px '+c;
}

// ======= ANALYZER =======
const SAMPLES={
  good:`#ì—­í• 
ë‹¹ì‹ ì€ 20ë…„ ê²½ë ¥ì˜ ë¬´ì—­ ê´€ì„¸ì‚¬ì…ë‹ˆë‹¤.
FTA í˜‘ì •ì„¸ìœ¨ê³¼ ì›ì‚°ì§€ ê·œì •ì˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

#ì‘ì—…
ì•„ë˜ ìˆ˜ì¶œ í’ˆëª©ì˜ í•œ-ì•„ì„¸ì•ˆ FTA ì ìš© ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ë¶„ì„í•˜ì„¸ìš”.

í’ˆëª©ëª…: ìŠ¤í…Œì¸ë¦¬ìŠ¤ ì£¼ë°©ìš©í’ˆ
ìˆ˜ì¶œêµ­: í•œêµ­ / ìˆ˜ì…êµ­: ë² íŠ¸ë‚¨

#ë¶„ì„ ê¸°ì¤€
- í˜‘ì • ì„¸ìœ¨ ì ìš© ì—¬ë¶€
- ì›ì‚°ì§€ ê²°ì • ê¸°ì¤€
- í•„ìš” ì„œë¥˜ ëª©ë¡

#ì œì•½ ì¡°ê±´
> í™•ì‹¤í•˜ì§€ ì•Šì€ ì„¸ìœ¨ì€ ë°˜ë“œì‹œ "ì„¸ê´€ í™•ì¸ í•„ìš”"ë¡œ í‘œê¸°
> ë‹µë³€ì€ í•œêµ­ì–´ë¡œë§Œ

#ì¶œë ¥ í˜•ì‹
{"FTA_ì ìš©": true/false, "í˜‘ì •ì„¸ìœ¨": "", "í•„ìš”ì„œë¥˜": []}`,
  mid:`ë‹¹ì‹ ì€ ë¬´ì—­ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
HS codeë¥¼ ë¶„ë¥˜í•´ì£¼ì„¸ìš”.
í’ˆëª©: ë©´ í‹°ì…”ì¸ `,
  bad:`hsì½”ë“œ ì•Œë ¤ì¤˜`
};

function loadSample(t){document.getElementById('qaInput').value=SAMPLES[t];}

let analysisHistory = [];

function renderHistory(){
  const list = document.getElementById('historyList');
  const empty = document.getElementById('historyEmpty');
  if(!analysisHistory.length){list.innerHTML='';empty.style.display='block';return;}
  empty.style.display='none';
  list.innerHTML = analysisHistory.slice().reverse().map((h,i)=>{
    const col = h.score>=80?'var(--neon3)':h.score>=60?'var(--neon4)':'var(--neon2)';
    return `<div onclick="loadHistoryItem(${analysisHistory.length-1-i})" style="padding:8px 10px;border:1px solid var(--border);border-radius:3px;margin-bottom:5px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:all 0.2s;" onmouseover="this.style.borderColor='var(--neon)'" onmouseout="this.style.borderColor='var(--border)'">
      <div style="font-family:'Orbitron',monospace;font-size:14px;font-weight:900;color:${col};min-width:32px;">${h.score}</div>
      <div style="flex:1;overflow:hidden;">
        <div style="font-size:11px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${h.preview}</div>
        <div style="font-size:10px;color:var(--text-muted);font-family:'JetBrains Mono',monospace;">${h.time} ${h.aiMode?'Â· AI':'Â· ìì²´'}</div>
      </div>
    </div>`;
  }).join('');
}

function loadHistoryItem(i){
  document.getElementById('qaInput').value = analysisHistory[i].prompt;
}

function clearHistory(){
  analysisHistory=[];renderHistory();
}

async function analyzePrompt(aiMode){
  const txt = document.getElementById('qaInput').value.trim();
  if(!txt){document.getElementById('qaInput').focus();return;}

  document.getElementById('qa-empty').style.display='none';
  document.getElementById('qa-result').style.display='none';
  document.getElementById('improvedPanel').style.display='none';
  document.getElementById('qa-loading').style.display='block';

  // --- local scoring ---
  const criteria=[
    {name:'ëª…í™•ì„±',max:20,score:scoreClarity(txt)},
    {name:'êµ¬ì¡°í™”',max:20,score:scoreStructure(txt)},
    {name:'êµ¬ì²´ì„±',max:20,score:scoreSpecificity(txt)},
    {name:'ì œì•½ì¡°ê±´',max:20,score:scoreConstraints(txt)},
    {name:'ì¶œë ¥ì •ì˜',max:20,score:scoreOutput(txt)},
  ];
  const total=criteria.reduce((s,c)=>s+c.score,0);
  const suggestions=generateSuggestions(txt,criteria);

  let aiComment = null;
  let improvedPrompt = null;

  if(aiMode){
    try{
      const res = await fetch('/api/openai', {
        method: 'POST', 
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'gpt-4o-mini', 
          response_format: { type: "json_object" }, 
          messages: [{
            role: 'user', 
            content: `ë‹¤ìŒ í”„ë¡¬í”„íŠ¸ë¥¼ ë¶„ì„í•˜ê³  JSONìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.\n\ní”„ë¡¬í”„íŠ¸:\n${txt}\n\nì‘ë‹µ í˜•ì‹ (ë°˜ë“œì‹œ JSON í˜•ì‹ì„ ì§€í‚¬ ê²ƒ):\n{"comment":"ì´ í”„ë¡¬í”„íŠ¸ì˜ ê°•ì ê³¼ ì•½ì ì„ í•œêµ­ì–´ë¡œ 2~3ë¬¸ì¥ ì½”ë©˜íŠ¸","improved":"ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ ì „ì²´ë¥¼ ì™„ì„±ë„ ìˆê²Œ ì‘ì„± (ë§ˆí¬ë‹¤ìš´ êµ¬ì¡° ì‚¬ìš©)"}`
          }]
        })
      });
      const data = await res.json();
      if(data.error) throw new Error(data.error.message);
      
      const raw = data.choices[0].message.content.trim();
      const parsed = JSON.parse(raw);
      
      aiComment = parsed.comment;
      improvedPrompt = parsed.improved;
    }catch(e){
      console.error(e);
      aiComment = 'âš ï¸ AI ë¶„ì„ ì—°ê²° ì˜¤ë¥˜. ìì²´ ë¶„ì„ ê²°ê³¼ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.';
    }
  }

  document.getElementById('qa-loading').style.display='none';
  document.getElementById('qa-result').style.display='block';

  // Ring animation
  const ring=document.getElementById('ringFill');
  const num=document.getElementById('ringNum');
  const circumference=314;
  const offset=circumference-(total/100)*circumference;
  const color=total>=80?'#00ff88':total>=60?'#ffaa00':'#ff00aa';
  ring.style.stroke=color;
  setTimeout(()=>{ring.style.strokeDashoffset=offset;},50);
  let n=0;const timer=setInterval(()=>{n++;num.textContent=n;num.style.color=color;if(n>=total)clearInterval(timer);},15);

  // Grade
  const grades={90:'S â€” ë§ˆìŠ¤í„°ê¸‰',80:'A â€” ì „ë¬¸ê°€',70:'B â€” ì¤‘ê¸‰',60:'C â€” ì…ë¬¸',0:'D â€” ê°œì„  í•„ìš”'};
  const grade = Object.entries(grades).reverse().find(([t])=>total>=parseInt(t));
  document.getElementById('gradeLabel').innerHTML = `<span style="color:${color}">${grade?grade[1]:''}</span>`;

  // Bars
  const cl=document.getElementById('criteriaList');
  cl.innerHTML='';
  criteria.forEach(c=>{
    const pct=(c.score/c.max)*100;
    const bc=pct>=80?'#00ff88':pct>=60?'#ffaa00':'#ff00aa';
    cl.innerHTML+=`<div class="crit-row">
      <div class="crit-name">${c.name}</div>
      <div class="crit-bar"><div class="crit-fill" style="width:0%;background:${bc}" data-w="${pct}"></div></div>
      <div class="crit-val">${c.score}</div>
    </div>`;
  });
  setTimeout(()=>{document.querySelectorAll('.crit-fill').forEach(f=>{f.style.width=f.dataset.w+'%';});},100);

  // AI Comment
  const acBox = document.getElementById('aiCommentBox');
  const acText = document.getElementById('aiCommentText');
  if(aiComment){
    acBox.style.display='block';
    acText.textContent = aiComment;
    // color by sentiment
    const hasError = aiComment.includes('ì˜¤ë¥˜');
    acBox.style.borderLeftColor = hasError ? 'var(--neon2)' : 'var(--neon3)';
    acBox.style.background = hasError ? 'rgba(255,0,170,0.04)' : 'rgba(0,255,136,0.04)';
  } else {
    acBox.style.display='none';
  }

  // Suggestions
  const sl=document.getElementById('suggList');
  sl.innerHTML=suggestions.map(s=>`<div class="sug-item ${s.level}">${s.text}</div>`).join('');

  // Improved panel
  if(improvedPrompt){
    document.getElementById('improvedPanel').style.display='block';
    document.getElementById('improvedText').textContent = improvedPrompt;
    window._improvedPrompt = improvedPrompt;
  }

  // Save to history
  analysisHistory.push({
    score: total, prompt: txt,
    preview: txt.substring(0,60).replace(/\n/g,' ')+'â€¦',
    time: new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'}),
    aiMode
  });
  if(analysisHistory.length>10) analysisHistory.shift();
  renderHistory();
}

function copyImproved(){
  const t = window._improvedPrompt || '';
  navigator.clipboard.writeText(t).then(()=>{
    const btn = document.querySelector('#improvedPanel .bb.g');
    const orig = btn.textContent;
    btn.textContent='âœ… COPIED!';
    setTimeout(()=>btn.textContent=orig, 2000);
  });
}

function loadImproved(){
  if(!window._improvedPrompt) return;
  // Clear builder and send to builder input as role block
  clearCanvas();
  showSec('builder');
  setTimeout(()=>{
    // Add as a freeform role block with content
    const canvas=document.getElementById('canvas-blocks');
    document.getElementById('canvas-empty').style.display='none';
    const div=document.createElement('div');
    div.className='dropped-block';div.dataset.key='role';div.dataset.label='#ê°œì„ ë³¸';
    div.innerHTML=`<div class="block-label">#ê°œì„ ë³¸</div>
      <textarea style="flex:1;background:transparent;border:none;color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:12px;outline:none;resize:none;line-height:1.7;min-height:120px;">${window._improvedPrompt}</textarea>
      <button class="del-block" onclick="this.parentElement.remove();checkEmpty();previewPrompt();">Ã—</button>`;
    canvas.appendChild(div);
    div.querySelector('textarea').addEventListener('input',previewPrompt);
    previewPrompt();
  },300);
}

function scoreClarity(t){
  let s=8;
  if(t.length>50)s+=4;
  if(t.includes('ë‹¹ì‹ ì€')||t.includes('You are'))s+=4;
  if(t.length>200)s+=4;
  return Math.min(20,s);
}
function scoreStructure(t){
  let s=0;
  if(t.includes('#'))s+=6;
  if(t.includes('```')||t.includes("'''"))s+=4;
  if(t.includes('\n'))s+=4;
  if(t.includes('>')&&t.includes('#'))s+=6;
  return Math.min(20,s);
}
function scoreSpecificity(t){
  let s=4;
  const kws=['ë°˜ë“œì‹œ','êµ¬ì²´ì ','ì˜ˆì‹œ','ì˜ˆ:','í˜•ì‹','ë‹¨ê³„','ì ˆì°¨'];
  kws.forEach(k=>{if(t.includes(k))s+=2;});
  return Math.min(20,s);
}
function scoreConstraints(t){
  let s=0;
  if(t.includes('>'))s+=6;
  if(t.includes('ë°˜ë“œì‹œ')||t.includes('ì ˆëŒ€'))s+=4;
  if(t.includes('ì´ë‚´')||t.includes('ì ì´ë‚´')||t.includes('ì¤„ ì´ë‚´'))s+=5;
  if(t.includes('ì œì•½')||t.includes('constraint'))s+=5;
  return Math.min(20,s);
}
function scoreOutput(t){
  let s=0;
  if(t.includes('json')||t.includes('JSON'))s+=8;
  if(t.includes('ì¶œë ¥')||t.includes('í˜•ì‹'))s+=6;
  if(t.includes('{')||t.includes('['))s+=6;
  return Math.min(20,s);
}
function generateSuggestions(t,criteria){
  const sugs=[];
  if(criteria[0].score<14)sugs.push({level:'sug-high',text:'ğŸ”´ ì—­í• (í˜ë¥´ì†Œë‚˜)ì´ ë¶ˆëª…í™•í•©ë‹ˆë‹¤. "ë‹¹ì‹ ì€ ~ì „ë¬¸ê°€ì…ë‹ˆë‹¤"ë¡œ ì‹œì‘í•˜ì„¸ìš”.'});
  if(criteria[1].score<12)sugs.push({level:'sug-high',text:'ğŸ”´ êµ¬ì¡°í™”ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. #ì—­í•  #ì‘ì—… #ì¶œë ¥ í—¤ë”ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.'});
  if(criteria[2].score<12)sugs.push({level:'sug-mid',text:'ğŸŸ¡ êµ¬ì²´ì„±ì„ ë†’ì´ì„¸ìš”. ì˜ˆì‹œ(í“¨ìƒ·)ë‚˜ êµ¬ì²´ì  ì¡°ê±´ì„ ì¶”ê°€í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.'});
  if(criteria[3].score<12)sugs.push({level:'sug-mid',text:'ğŸŸ¡ ì œì•½ ì¡°ê±´ì´ ì—†ìŠµë‹ˆë‹¤. "> ë°˜ë“œì‹œ ~í•˜ì„¸ìš”" í˜•ì‹ìœ¼ë¡œ í•µì‹¬ ê·œì¹™ì„ ì§€ì •í•˜ì„¸ìš”.'});
  if(criteria[4].score<12)sugs.push({level:'sug-mid',text:'ğŸŸ¡ ì¶œë ¥ í˜•ì‹ì´ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. JSON ë˜ëŠ” íŠ¹ì • í˜•ì‹ì„ ì§€ì •í•˜ì„¸ìš”.'});
  const total=criteria.reduce((s,c)=>s+c.score,0);
  if(total>=80)sugs.push({level:'sug-low',text:'ğŸŸ¢ ì „ë°˜ì ìœ¼ë¡œ ìš°ìˆ˜í•œ í”„ë¡¬í”„íŠ¸ì…ë‹ˆë‹¤! ì‹¤ë¬´ì— ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.'});
  if(sugs.length===0)sugs.push({level:'sug-low',text:'ğŸŸ¢ ì¢‹ìŠµë‹ˆë‹¤! í“¨ìƒ· ì˜ˆì‹œë¥¼ ì¶”ê°€í•˜ë©´ ë”ìš± ì •í™•í•œ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'});
  return sugs;
}

// ======= BUILDER =======
const blockDefaults={
  role:'20ë…„ ê²½ë ¥ì˜ ë¬´ì—­ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\nFTA í˜‘ì •ì„¸ìœ¨ê³¼ ì›ì‚°ì§€ ê·œì •ì˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.',
  task:'ì•„ë˜ ìˆ˜ì¶œ í’ˆëª©ì˜ FTA ì ìš© ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ë¶„ì„í•˜ì„¸ìš”.',
  context:'ì¤‘ì†Œê¸°ì—… ë¬´ì—­íŒ€ ë‹´ë‹¹ìê°€ ì²˜ìŒìœ¼ë¡œ FTAë¥¼ í™œìš©í•˜ë ¤ëŠ” ìƒí™©ì…ë‹ˆë‹¤.',
  input:'í’ˆëª©ëª…: {product_name}\nìˆ˜ì¶œêµ­: í•œêµ­\nìˆ˜ì…êµ­: {country}',
  constraint:'- ë‹µë³€ì€ 500ì ì´ë‚´\n- í™•ì‹¤í•˜ì§€ ì•Šì€ ì„¸ìœ¨ì€ "ì„¸ê´€ í™•ì¸ í•„ìš”"ë¡œ í‘œê¸°',
  output:'JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜:\n{"FTA_ì ìš©": true/false, "í˜‘ì •ì„¸ìœ¨": "", "í•„ìš”ì„œë¥˜": []}',
  tone:'ì‰½ê³  ì‹¤ìš©ì ì¸ ì–¸ì–´ë¡œ, ì „ë¬¸ ìš©ì–´ ì‚¬ìš© ì‹œ ê´„í˜¸ ì•ˆì— ì„¤ëª… ì¶”ê°€',
  example:'ì…ë ¥: "ë©´ í‹°ì…”ì¸ " â†’ ì¶œë ¥: {"FTA_ì ìš©": true, "í˜‘ì •ì„¸ìœ¨": "0%"}',
  persona:'ì§ì±…: ì¤‘ì†Œê¸°ì—… ë¬´ì—­íŒ€ì¥\nê²½ë ¥: í•´ì™¸ì˜ì—… 3ë…„\nìˆ˜ì¤€: FTA ì´ˆë³´',
  priority:'ğŸ”´ ê°œì¸ì •ë³´ ì ˆëŒ€ ì¶œë ¥ ê¸ˆì§€\nğŸŸ¡ 500ì ì´ë‚´ ë‹µë³€\nğŸŸ¢ ê°€ëŠ¥í•˜ë©´ ì‹¤ì œ ì‚¬ë¡€ í¬í•¨'
};

function addBlock(item){
  const key=item.dataset.key;
  const label=item.dataset.label;
  const canvas=document.getElementById('canvas-blocks');
  const empty=document.getElementById('canvas-empty');
  empty.style.display='none';
  const div=document.createElement('div');
  div.className='dropped-block';div.dataset.key=key;div.dataset.label=label;
  div.innerHTML=`<div class="block-label">${label}</div>
    <textarea onchange="previewPrompt()">${blockDefaults[key]||''}</textarea>
    <button class="del-block" onclick="this.parentElement.remove();checkEmpty();previewPrompt();">Ã—</button>`;
  canvas.appendChild(div);
  div.querySelector('textarea').addEventListener('input',previewPrompt);
}

function checkEmpty(){
  const canvas=document.getElementById('canvas-blocks');
  document.getElementById('canvas-empty').style.display=canvas.children.length?'none':'flex';
}

function loadTemplate(t){
  clearCanvas();
  if(t==='persona'){
    ['role','task','input','constraint','output'].forEach(k=>{
      const el=document.querySelector(`[data-key="${k}"]`);
      if(el)addBlock(el);
    });
  }else if(t==='costar'){
    ['context','task','tone','persona','constraint','output'].forEach(k=>{
      const el=document.querySelector(`[data-key="${k}"]`);
      if(el)addBlock(el);
    });
  }
}

function clearCanvas(){
  document.getElementById('canvas-blocks').innerHTML='';
  document.getElementById('canvas-empty').style.display='flex';
  document.getElementById('builderOutput').style.display='none';
}

function previewPrompt(){
  const blocks=document.querySelectorAll('.dropped-block');
  if(!blocks.length)return;
  let out='';
  blocks.forEach(b=>{
    const label=b.dataset.label;
    const val=b.querySelector('textarea').value.trim();
    out+=label+'\n'+val+'\n\n';
  });
  const output=document.getElementById('builderOutput');
  output.style.display='block';
  output.textContent=out.trim();
}

function copyBuilderOutput(){
  previewPrompt();
  const t=document.getElementById('builderOutput').textContent;
  if(!t)return;
  navigator.clipboard.writeText(t).then(()=>{
    const btn=document.querySelector('.builder-btns .bb.g');
    btn.textContent='COPIED!';btn.style.color='var(--neon3)';
    setTimeout(()=>{btn.textContent='COPY';btn.style.color='';},2000);
  });
}

// ======= BATTLE =======
async function doBattle(){
  const a=document.getElementById('battleA').value.trim();
  const b=document.getElementById('battleB').value.trim();
  if(!a||!b){alert('ë‘ í”„ë¡¬í”„íŠ¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!');return;}
  document.getElementById('battleBtn').disabled=true;
  document.getElementById('battle-loading').style.display='block';
  document.getElementById('battle-result-area').style.display='none';

  try{
    const res = await fetch('/api/openai', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        model: 'gpt-4o-mini',
        response_format: { type: "json_object" },
        messages: [{
          role: 'user', 
          content: `ë‘ í”„ë¡¬í”„íŠ¸ë¥¼ ë¹„êµ ë¶„ì„í•˜ê³  ë°˜ë“œì‹œ JSONìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.\n\ní”„ë¡¬í”„íŠ¸ A:\n${a}\n\ní”„ë¡¬í”„íŠ¸ B:\n${b}\n\nì‘ë‹µ í˜•ì‹ (ì´ í˜•ì‹ë§Œ ì¶œë ¥):\n{"winner":"A ë˜ëŠ” B","a_score":0~100,"b_score":0~100,"a_summary":"Aì˜ ê°•ì  í•œ ë¬¸ì¥","b_summary":"Bì˜ ê°•ì  í•œ ë¬¸ì¥","analysis":"ë‘ í”„ë¡¬í”„íŠ¸ ë¹„êµ ë¶„ì„ 2~3ë¬¸ì¥","reason":"ìŠ¹ìê°€ ì´ê¸´ ì´ìœ  í•œ ë¬¸ì¥"}`
        }]
      })
    });
    const data = await res.json();
    if(data.error) throw new Error(data.error.message);

    const text = data.choices[0].message.content.trim();
    const parsed = JSON.parse(text);
    
    showBattleResult(parsed, a, b);
  }catch(e){
    document.getElementById('battle-result-area').style.display='block';
    document.getElementById('battleResult').innerHTML=`<div style="color:var(--neon2);font-family:'JetBrains Mono',monospace;font-size:12px;grid-column:1/-1;padding:20px;">âš ï¸ ë¶„ì„ ì¤‘ ì˜¤ë¥˜: ${e.message}</div>`;
  }finally{
    document.getElementById('battleBtn').disabled=false;
    document.getElementById('battle-loading').style.display='none';
  }
}

function showBattleResult(r,a,b){
  const area=document.getElementById('battle-result-area');
  area.style.display='block';
  const br=document.getElementById('battleResult');
  const aWin=r.winner==='A';
  br.innerHTML=`
    <div class="battle-res-card ${aWin?'winner':''}">
      ${aWin?'<div class="winner-badge">ğŸ‘‘ WINNER</div>':''}
      <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--neon);margin-bottom:8px;">CHALLENGER A</div>
      <div class="battle-meter"><div class="meter-fill" style="width:${r.a_score}%;background:${aWin?'var(--neon)':'var(--text-muted)'}"></div></div>
      <div style="font-family:'Orbitron',monospace;font-size:20px;color:${aWin?'var(--neon)':'var(--text-dim)'};margin:4px 0;">${r.a_score}<span style="font-size:11px;">/100</span></div>
      <div style="font-size:12px;color:var(--text-dim);line-height:1.6;">${r.a_summary||''}</div>
    </div>
    <div class="battle-res-card ${!aWin?'winner':''}">
      ${!aWin?'<div class="winner-badge">ğŸ‘‘ WINNER</div>':''}
      <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--neon2);margin-bottom:8px;">CHALLENGER B</div>
      <div class="battle-meter"><div class="meter-fill" style="width:${r.b_score}%;background:${!aWin?'var(--neon2)':'var(--text-muted)'}"></div></div>
      <div style="font-family:'Orbitron',monospace;font-size:20px;color:${!aWin?'var(--neon2)':'var(--text-dim)'};margin:4px 0;">${r.b_score}<span style="font-size:11px;">/100</span></div>
      <div style="font-size:12px;color:var(--text-dim);line-height:1.6;">${r.b_summary||''}</div>
    </div>`;
  document.getElementById('battleAnalysis').innerHTML=`<span style="color:var(--neon4);font-family:'JetBrains Mono',monospace;font-size:10px;letter-spacing:1px;">// ANALYSIS</span><br><br>${r.analysis||''}<br><br><strong style="color:var(--neon);">ìŠ¹ë¦¬ ì´ìœ :</strong> ${r.reason||''}`;
}

// ======= GENERATOR =======
async function doGenerate(){
  const pattern=document.getElementById('patSel').value;
  const goal=document.getElementById('genGoal').value.trim();
  const lang=document.getElementById('genLang').value;
  const extra=document.getElementById('genExtra').value.trim();
  const dom=document.querySelector('#sec-gen .chip.selected')?.textContent||'ë¬´ì—­/ìˆ˜ì¶œ';
  if(!goal){document.getElementById('genGoal').focus();return;}

  const pmap={
    persona:'í˜ë¥´ì†Œë‚˜ íŒ¨í„´ (ì—­í• +ê²½ë ¥+ì „ë¬¸ë¶„ì•¼+ë§íˆ¬ 4ìš”ì†Œ)',
    multi:'ë©€í‹° í˜ë¥´ì†Œë‚˜ íŒ¨í„´ (3ëª…ì˜ ë‹¤ë¥¸ ê´€ì  ì „ë¬¸ê°€)',
    recipe:'ë ˆì‹œí”¼ íŒ¨í„´ (STEP, í• ì¼, ì†Œìš”ì‹œê°„, ì™„ë£Œê¸°ì¤€, ì£¼ì˜ì‚¬í•­)',
    alt:'ëŒ€ì•ˆ ì ‘ê·¼ë²• íŒ¨í„´ (ìµœì†Œ 4ê°€ì§€, ì¥ë‹¨ì  ë¹„êµ)',
    costar:'CO-STAR (Context/Objective/Style/Tone/Audience/Response)',
    roses:'ROSES (Role/Objective/Scenario/Expected Solution/Steps)',
    focus:'FOCUS (Function/Objective/Context/Utility/Specifications)',
    '5w1h':'5W1H (Who/What/When/Where/Why/How)',
    cog:'ì¸ì§€ ê²€ì¦ì íŒ¨í„´ (í•˜ìœ„ ì§ˆë¬¸ 3~5ê°œ ë„ì¶œ í›„ ê²€ì¦)',
    ref:'ë¦¬í”Œë ‰ì…˜ íŒ¨í„´ (ì´ˆì•ˆâ†’ìê¸°ë¹„í‰â†’ê°œì„ ë³¸)',
    inv:'ë’¤ì§‘íŒ ìƒí˜¸ì‘ìš© (AIê°€ ë¨¼ì € ì§ˆë¬¸, ì •ë³´ ìˆ˜ì§‘ í›„ ìƒì„±)'
  };

  document.getElementById('genBtn').disabled=true;
  document.getElementById('genLoading').classList.add('v');
  document.getElementById('genOutput').innerHTML='';
  document.getElementById('genCopy').style.display='none';

  try{
    const res = await fetch('/api/openai', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        model: 'gpt-4o', // ìƒì„± ì‘ì—…ì€ í€„ë¦¬í‹°ê°€ ì¤‘ìš”í•˜ë¯€ë¡œ gpt-4o ì‚¬ìš©
        messages: [
          { role: 'system', content: 'ë‹¹ì‹ ì€ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ìš”ì²­í•œ íŒ¨í„´ì— ë§ëŠ” ì‹¤ë¬´ìš© í”„ë¡¬í”„íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”. ë§ˆí¬ë‹¤ìš´ êµ¬ì¡°ë¥¼ í™œìš©í•˜ì—¬ ì™„ì„±ë„ ìˆê²Œ ì‘ì„±í•˜ì„¸ìš”.' },
          { role: 'user', content: `íŒ¨í„´: ${pmap[pattern]}\në„ë©”ì¸: ${dom}\nëª©í‘œ: ${goal}\nì¶œë ¥ì–¸ì–´: ${lang}${extra?'\nì¶”ê°€ì¡°ê±´: '+extra:''}\n\nìœ„ ì¡°ê±´ì— ë§ëŠ” ì‹¤ë¬´ìš© í”„ë¡¬í”„íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.` }
        ]
      })
    });
    const data = await res.json();
    if(data.error) throw new Error(data.error.message);

    const text = data.choices[0].message.content || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
    
    document.getElementById('genOutput').textContent = text;
    document.getElementById('genCopy').style.display = 'block';
  }catch(e){
    document.getElementById('genOutput').textContent = 'âš ï¸ ì˜¤ë¥˜: ' + e.message;
  }finally{
    document.getElementById('genBtn').disabled=false;
    document.getElementById('genLoading').classList.remove('v');
  }
}

function copyGen(){
  const t=document.getElementById('genOutput').textContent;
  navigator.clipboard.writeText(t).then(()=>{
    const btn=document.getElementById('genCopy');
    btn.textContent='âœ… COPIED!';
    setTimeout(()=>{btn.textContent='ğŸ“‹ COPY';},2000);
  });
}
</script>
</body>
</html>